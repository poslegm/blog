---
layout: post
title: "Драма у doobie и quill"
date: 2021-11-05 00:00:00
description: "Об отказе Роба Норриса поддерживать интеграцию с quill"
---

Новая микро-драма в Scala-сообществе: Роб Норрис, мейнтенер библиотеки для
работы с SQL doobie, [удалил](https://github.com/tpolecat/doobie/pull/1587)
интеграцию с другой библиотекой для SQL quill, потому что та вошла под крыло
компании Ziverge, с которой у Норриса личный конфликт.

Поддерживать интеграции нескольких независимых библиотек в общем случае большая
нагрузка на мейнтейнеров из-за необходимости «дружить» API, изменяющиеся без
согласования друг с другом. То, что такая интеграция находилась непосредственно
в doobie, а не поддерживалась в виде опосредованной библиотеки, накладывало
определённую нагрузку и риски на мейнтейнеров. Поэтому, на мой взгляд, они в
праве отказываться от поддержки таких решений по уйме причин: расхождения API,
сложность работы с зависимостями, нехватка личного времени и т.д.

Но Норрис решил в один момент разбомбить Воронеж, то есть конечных
пользователей, использующих эту интеграцию в проде. Что можно было сделать
лучше?
1. Вынести интеграцию в отдельный репозиторий на гитхабе, сохранив неймспейс и
   название джарника. Если не хочется делать это самостоятельно, поставить
   issue на авторов quill с обозначенными сроками отказа от поддержки.
2. Задепрекейтить код интеграции, обозначив версию, в которой он будет удалён.
3. Изначально держать коннекторы в отдельных репозиториях и [версионировать их
   независимо](https://chugunkov.dev/2019/05/01/satellites.html) от основной
   библиотеки. В этом плане ZIO более
   [дальновидно](https://github.com/zio/?q=interop&type=&language=&sort=).

Собственно, сообщество подсуетилось и
[спасло](https://github.com/polyvariant/doobie-quill) эти аж ~200 строк кода
интеграции. Которые, впрочем, можно и в свой проект скопипастить.

К слову, ценность этой интеграции для меня под вопросом. Писать код на DSL
квилла и запускать на транзакторе из doobie не особо здорово, потому что doobie
гвоздями прибит к jdbc. Хотелось бы наоборот, писать plain SQL в духе doobie и
запускать их на асинхронном драйвере к постгре или другой базе, которые как раз
[поддерживаются](https://getquill.io/#contexts-quill-jasync) в quill.

Эмоциональный выпад Норриса был замечен в высоких кабинетах Лозанны, и
профессор Одерски лично
[отметил](https://github.com/tpolecat/doobie/pull/1587#issuecomment-961415475)
поведение деструктивным. В ответ на форуме контрибуторов Scala была созданна
[тема](https://contributors.scala-lang.org/t/politics-safety-and-the-future-of-scala/5317),
в которой сообщество было обвинено в токсичности к меньшинствам, а Одерски чуть
ли не в причастности к убийствам. Но об SQL и поддержке библиотек там ни слова,
поэтому читать стоит только если хочется насладиться дивным новым миром.
